@*@model IEnumerable<MechanicsForum.Models.AspNetUser>

    @{
        ViewBag.Title = "Index";
    }*@
<style>
</style>

<body id="home">
    <h2>Manage Users</h2>

    <p>
        @Html.ActionLink("Create New", "Create")
    </p>

    <div class="rTable" id="tbldiv">
        <div class="rTableRow">
            <div class="rTableHead"><strong>User Name</strong></div>
            <div class="rTableHead"><span style="font-weight: bold;">Email</span></div>
            <div class="rTableHead">Role</div>
        </div>
    </div>

</body>
<script>
    window.addEventListener("load", function () {

        postData('/AspNetUsers/GetAllUsers')
            .then(function (response) {
                console.table(response);

                var tablediv = document.getElementById("tbldiv");
                for (var i = 0; i < response.result.length; i++)
                {
                    var rowdiv = document.createElement("div");
                    rowdiv.setAttribute("class", "rTableRow");
                    tablediv.appendChild(rowdiv);
                    var celldiv1 = document.createElement("div");
                    var celldiv2 = document.createElement("div");
                    var celldiv3 = document.createElement("div");
                    var celldiv4 = document.createElement("div");
                    var cellEdit = document.createElement("a");
                    var cellDetails = document.createElement("a");
                    var cellDelete = document.createElement("a");

                    celldiv1.setAttribute("class", "rTableCell col-sm-2 col-md-2");
                    celldiv2.setAttribute("class", "rTableCell col-sm-2 col-md-2");
                    celldiv3.setAttribute("class", "rTableCell col-sm-2 col-md-2");
                    cellEdit.setAttribute("class", "rCellOther col-sm-2 col-md-2");
                    cellDetails.setAttribute("class", "rCellOther col-sm-2 col-md-2");
                    cellDelete.setAttribute("class", "rCellOther col-sm-2 col-md-2");

                    celldiv1.innerHTML = response.result[i].UserName;
                    celldiv2.innerHTML = response.result[i].Email;
                    celldiv3.innerHTML = response.result[i].Role;
                    cellEdit.innerHTML = "Edit | ";
                    cellEdit.setAttribute("href", "/AspNetUsers/Edit/"+response.result[i].Id);
                    cellDetails.innerHTML = "Detail | ";
                    cellDetails.setAttribute("href", "/AspNetUsers/Details/" + response.result[i].Id);
                    cellDelete.innerHTML = "Delete";
                    cellDelete.setAttribute("href", "/AspNetUsers/Delete/" + response.result[i].Id);

                    tablediv.appendChild(celldiv1);
                    tablediv.appendChild(celldiv2);
                    tablediv.appendChild(celldiv3);
                    tablediv.appendChild(cellEdit);
                    tablediv.appendChild(cellDetails);
                    tablediv.appendChild(cellDelete);
                }
            })
    });

    function postData(url, data) {
        // Default options are marked with *
        return fetch(url, {
            body: JSON.stringify(data), // must match 'Content-Type' header
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'same-origin', // include, same-origin, *omit
            headers: {
                'user-agent': 'Mozilla/4.0 MDN Example',
                'content-type': 'application/json'
            },
            method: 'POST', // *GET, POST, PUT, DELETE, etc.
            mode: 'cors', // no-cors, cors, *same-origin
            redirect: 'follow', // manual, *follow, error
            referrer: 'no-referrer', // *client, no-referrer
        })
            .then(response => response.json()) // parses response to JSON
    }

</script>
